!function(e){var t="ontouchstart"in window||navigator.msMaxTouchPoints>0,n=[],i=null,o=e("<div/>",{id:"cm-overlay-mask"}),a=e("<div/>",{id:"cm-wrap"}),d=e("<div/>",{id:"cm-overlay"}),c=e("<div/>",{"class":"cm-content"}),r=e("<i/>",{"class":"cm-scale"}),s=e("<a/>",{href:"javascript:;",title:"Previous",id:"cm-prev"}).text("prev"),l=e("<a/>",{href:"javascript:;",title:"Next",id:"cm-next"}).text("next"),h=e("<a/>",{href:"javascript:;",title:"Press ESC to close",id:"cm-close"}).text("close"),f=900,u=.5625,m=0,p=0,v=0,w="none",g="none",b=function(){"none"!==w&&w.prepend(g),o.add(d).stop().clearQueue(),a.css("visibility","hidden"),o.fadeTo(500,0,function(){e(this).hide()}),d.fadeTo(200,0).removeClass("cm-box").removeAttr("style").find(c).empty(),e("html").removeClass("overlay-visible")},y=function(){d.addClass("cm-box").fadeTo(0,1)},x=function(){"number"==typeof window.innerWidth?(p=window.innerWidth,m=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(p=document.documentElement.clientWidth,m=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(p=document.body.clientWidth,m=document.body.clientHeight),v=10*Math.round(.9*m/10)},k=function(e){objLength=i.length-1,0===e?(s.hide(),l.show(),e===objLength&&l.hide()):e===objLength?(s.show(),l.hide()):s.add(l).show()},C=function(t,o){x();var r=e(i[t]);c.empty(),d.fadeTo(0,0);var s=r.attr("href");if(r.is("[rel]")){c.prepend('<iframe width="640" height="360" frameborder="0" allowfullscreen="" src="'+s+'?autoplay=1;wmode=opaque;showinfo=0;rel=0;"></iframe>');var l=d.find("iframe"),h=l.attr("width");f>h&&(h=f);var m=h*u;l.attr({width:h,height:m}),o()}else if(r.is('[href*="#"]'))location.hash="",w=e(s).parent(),r=e(s).detach(),c.prepend(r),o();else{if(r.is("[alt]"))var p=r.attr("alt");e.inArray(s,n)>-1?a.addClass("cm-loaded"):a.removeClass("cm-loaded");var g=e("<img/>",{src:s,alt:p});c.prepend(g.on("load",function(){n.push(s);var e=g.height();e>v&&(e=v),g.attr("height",e),o()}))}};e(window).on("swipeleft",function(){l.trigger("tap")}),e(window).on("swiperight",function(){s.trigger("tap")}),e(document).keydown(function(e){switch(e.which){case 27:b();break;case 37:s.trigger("tap");break;case 38:break;case 39:l.trigger("tap");break;case 40:break;default:return}e.preventDefault()});var j=function(n){var i=function(e){var t=p-d.width();d.clearQueue(),"prev"==e?n--:(n++,t=t*=-1),d.animate({left:t},150,function(){C(n,function(){var i=d.width();t=(p-i)/2+i+60,"prev"==e&&(t=t*=-1),y(),d.css("left",t).animate({left:0},150,function(){a.addClass("cm-loaded")}),k(n)})})};e("#overlay-mask").length||(e("body").append(o.hide().fadeTo(0,0),a.append(d.append(c),r,s,l,h)),t===!1&&h.tooltip({position:"bottom center",effect:"fade"}),s.on("tap",function(){s.is(":visible")&&i("prev")}),l.on("tap",function(){l.is(":visible")&&i("next")}),a.on("tap",function(t){(!e(t.target).is(e(d.find("*")).add(s).add(l))||e(t.target).is(e(h)))&&b()})),e("html").addClass("overlay-visible"),k(n),o.show().fadeTo(500,.8,function(){a.css("visibility","visible"),C(n,function(){y()})})};e.fn.cmOverlay=function(){return null!==i&&i.each(function(){e(this).off()}),i=this,this.each(function(t){e(this).on("tap",function(e){e.preventDefault(),j(t)})})}}(jQuery);